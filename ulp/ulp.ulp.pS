       
       
       
    .bss
    .global ctr
ctr:
    .long 0
    .text
    .global entry
entry:
    move r3, ctr
    REG_RD ((((0x3ff48400 + 0x24)) - 0x3ff48000) / 4), ((14) + (16) - 1), (14)
    and r0, r0, 2048
    jumpr press, 1, LT
    ld r0, r3, 0
    jumpr nopress, 1, LT
    REG_WR ((((0x3ff48800 + 0x0018)) - 0x3ff48000) / 4), ((0) + (8) - 1), (0), ((0xF0) & 0xff)
    REG_WR ((((0x3ff48800 + 0x0018)) - 0x3ff48000) / 4), ((8) + (8) - 1), (8), ((0x49) & 0xff)
    REG_WR ((((0x3ff48800 + 0x0018)) - 0x3ff48000) / 4), ((16) + (8) - 1), (16), ((0x02) & 0xff)
    REG_WR ((((0x3ff48800 + 0x0018)) - 0x3ff48000) / 4), ((24) + (8) - 1), (24), ((0) & 0xff)
nopress:
    move r0, 0
    st r0, r3, 0
    halt
press:
    ld r0, r3, 0
    jumpr fast, 1, GE
    REG_WR ((((0x3ff48800 + 0x0018)) - 0x3ff48000) / 4), ((0) + (8) - 1), (0), ((0x98) & 0xff)
    REG_WR ((((0x3ff48800 + 0x0018)) - 0x3ff48000) / 4), ((8) + (8) - 1), (8), ((0x3A) & 0xff)
    REG_WR ((((0x3ff48800 + 0x0018)) - 0x3ff48000) / 4), ((16) + (8) - 1), (16), ((0) & 0xff)
    REG_WR ((((0x3ff48800 + 0x0018)) - 0x3ff48000) / 4), ((24) + (8) - 1), (24), ((0) & 0xff)
fast:
    add r0, r0, 1
    jumpr btnheld, 20, GE
    st r0, r3, 0
    halt
btnheld:
    ; REG_WR ((((0x3ff48400 + 0x10)) - 0x3ff48000) / 4), ((14 + 16) + (1) - 1), (14 + 16), ((1) & 0xff)
    ; REG_WR ((((0x3ff48400 + 0x4)) - 0x3ff48000) / 4), ((14 + 16) + (1) - 1), (14 + 16), ((1) & 0xff)
    ; wait 8000
    adc r0, 0, 7
    st r0, r3, 0
    jumpr lowbat, 1805, LT
trywake:
    REG_RD ((((0x3ff48000 + 0xc0)) - 0x3ff48000) / 4), ((19) + ((((((((0x1) >> (0)) & 1) + (((0x1) >> (0 + 1)) & 1)) + ((((0x1) >> (0 + 2)) & 1) + (((0x1) >> (0 + 2 + 1)) & 1))) + (((((0x1) >> (0 + 4)) & 1) + (((0x1) >> (0 + 4 + 1)) & 1)) + ((((0x1) >> (0 + 4 + 2)) & 1) + (((0x1) >> (0 + 4 + 2 + 1)) & 1)))) + ((((((0x1) >> (0 + 8)) & 1) + (((0x1) >> (0 + 8 + 1)) & 1)) + ((((0x1) >> (0 + 8 + 2)) & 1) + (((0x1) >> (0 + 8 + 2 + 1)) & 1))) + (((((0x1) >> (0 + 8 + 4)) & 1) + (((0x1) >> (0 + 8 + 4 + 1)) & 1)) + ((((0x1) >> (0 + 8 + 4 + 2)) & 1) + (((0x1) >> (0 + 8 + 4 + 2 + 1)) & 1)))))) - 1), (19)
    wake
    jumpr trywake, 1, LT
lowbat:
    REG_WR ((((0x3ff48400 + 0x74)) - 0x3ff48000) / 4), ((0 + 11) + (1) - 1), (0 + 11), ((0) & 0xff)
    REG_WR ((((0x3ff48000 + 0x18)) - 0x3ff48000) / 4), ((24) + (((((((0x1) >> (0)) & 1) + (((0x1) >> (0 + 1)) & 1)) + ((((0x1) >> (0 + 2)) & 1) + (((0x1) >> (0 + 2 + 1)) & 1))) + (((((0x1) >> (0 + 4)) & 1) + (((0x1) >> (0 + 4 + 1)) & 1)) + ((((0x1) >> (0 + 4 + 2)) & 1) + (((0x1) >> (0 + 4 + 2 + 1)) & 1))))) - 1), (24), ((((0) & 0x1)) & 0xff)
    halt
